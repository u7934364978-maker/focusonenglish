┌─────────────────────────────────────────────────────────────────────────────┐
│                    COOKIEBOT CONSENT FLOW DIAGRAM                           │
│                         Focus English Website                               │
└─────────────────────────────────────────────────────────────────────────────┘

                              USER VISITS WEBSITE
                                      │
                                      ▼
                         ┌────────────────────────┐
                         │   Page Loads           │
                         │   app/layout.tsx       │
                         └────────────┬───────────┘
                                      │
                                      ▼
                         ┌────────────────────────┐
                         │ <Cookiebot /> Component│
                         │ strategy="beforeInteractive" │
                         │ Loads FIRST            │
                         └────────────┬───────────┘
                                      │
                                      ▼
                         ┌────────────────────────┐
                         │ Cookiebot Script       │
                         │ consent.cookiebot.com  │
                         │ ID: 474b1dce...        │
                         └────────────┬───────────┘
                                      │
                                      ▼
                         ┌────────────────────────┐
                         │ Check Consent Status   │
                         └────────────┬───────────┘
                                      │
                  ┌───────────────────┴───────────────────┐
                  │                                       │
         Consent EXISTS                          NO Consent Found
                  │                                       │
                  ▼                                       ▼
    ┌─────────────────────────┐           ┌──────────────────────────┐
    │ Load with User Prefs    │           │ Display Consent Banner   │
    │ - Statistics: Yes/No    │           │                          │
    │ - Marketing: Yes/No     │           │  ┌────────────────────┐  │
    └──────────┬──────────────┘           │  │  Cookie Consent    │  │
               │                           │  │                    │  │
               │                           │  │ [Accept All]       │  │
               │                           │  │ [Reject]           │  │
               │                           │  │ [Customize]        │  │
               │                           │  └────────────────────┘  │
               │                           └────────────┬─────────────┘
               │                                        │
               │                           ┌────────────┴────────────┐
               │                           │                         │
               │                    USER ACCEPTS              USER REJECTS
               │                           │                         │
               │                           ▼                         ▼
               │              ┌──────────────────────┐  ┌─────────────────────┐
               │              │ Consent Granted      │  │ Consent Denied      │
               │              │ statistics: true     │  │ statistics: false   │
               │              │ marketing: false     │  │ marketing: false    │
               │              └──────────┬───────────┘  └──────────┬──────────┘
               │                         │                         │
               └─────────────────────────┴─────────────────────────┘
                                         │
                                         ▼
                         ┌────────────────────────┐
                         │ Store Consent Choice   │
                         │ (Cookie + Server Log)  │
                         └────────────┬───────────┘
                                      │
                                      ▼
                         ┌────────────────────────┐
                         │ <GoogleAnalytics />    │
                         │ Component Loads        │
                         │ data-cookieconsent="statistics" │
                         └────────────┬───────────┘
                                      │
                  ┌───────────────────┴───────────────────┐
                  │                                       │
         Statistics GRANTED                      Statistics DENIED
                  │                                       │
                  ▼                                       ▼
    ┌─────────────────────────┐           ┌──────────────────────────┐
    │ ✅ Load GA Scripts      │           │ ❌ Block GA Scripts      │
    │ - gtag/js loads         │           │ - No gtag/js             │
    │ - _ga cookies set       │           │ - No cookies set         │
    │ - Tracking active       │           │ - No tracking            │
    │ - IP anonymized         │           │                          │
    └─────────────────────────┘           └──────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                         COOKIE CATEGORIES                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────┐
│   NECESSARY      │  ← Always Enabled (Required for site to function)
│   (Required)     │     - Session cookies
└──────────────────┘     - Security cookies

┌──────────────────┐
│   PREFERENCES    │  ← User Choice (Remember settings)
│   (Optional)     │     - Language preference
└──────────────────┘     - UI preferences

┌──────────────────┐
│   STATISTICS     │  ← User Choice (Analytics) ← GOOGLE ANALYTICS HERE
│   (Optional)     │     - Google Analytics (_ga, _gid, _gat)
└──────────────────┘     - Anonymous usage tracking

┌──────────────────┐
│   MARKETING      │  ← User Choice (Advertising)
│   (Optional)     │     - Ad tracking pixels
└──────────────────┘     - Remarketing tags


┌─────────────────────────────────────────────────────────────────────────────┐
│                         USER JOURNEY SCENARIOS                               │
└─────────────────────────────────────────────────────────────────────────────┘

Scenario 1: ACCEPT ALL
─────────────────────────
Visit → Banner → [Accept All] → Statistics ✅ → GA Loads → Tracking Active

Scenario 2: REJECT STATISTICS
──────────────────────────────
Visit → Banner → [Customize] → Statistics ❌ → GA Blocked → No Tracking

Scenario 3: CHANGE MIND (Withdraw)
───────────────────────────────────
Tracking Active → Cookie Settings → Withdraw Statistics → GA Stops → No More Tracking

Scenario 4: RETURNING VISITOR (Consent Stored)
───────────────────────────────────────────────
Visit → Cookiebot Reads Consent → Apply Previous Choice → No Banner


┌─────────────────────────────────────────────────────────────────────────────┐
│                         COMPONENT STRUCTURE                                  │
└─────────────────────────────────────────────────────────────────────────────┘

app/layout.tsx
│
├─ <html>
│  │
│  ├─ <head>
│  │  └─ Schema, Meta tags, Anti-piracy scripts
│  │
│  └─ <body>
│     │
│     ├─ 1. <Cookiebot />  ← LOADS FIRST (beforeInteractive)
│     │     │
│     │     └─ Script: consent.cookiebot.com/uc.js
│     │        - Manages consent
│     │        - Shows banner
│     │        - Stores preferences
│     │
│     ├─ 2. <GoogleAnalytics />  ← LOADS AFTER (afterInteractive)
│     │     │
│     │     └─ Script: googletagmanager.com/gtag/js
│     │        - data-cookieconsent="statistics"
│     │        - Blocked until consent given
│     │        - anonymize_ip: true
│     │
│     └─ {children}  ← Page content


┌─────────────────────────────────────────────────────────────────────────────┐
│                    GDPR COMPLIANCE MAPPING                                   │
└─────────────────────────────────────────────────────────────────────────────┘

GDPR Article 6 (Lawful Basis)
  └─ Cookiebot: ✅ Obtains explicit consent before non-essential cookies

GDPR Article 7 (Conditions for Consent)
  └─ Cookiebot: ✅ Clear consent request, easy to withdraw, consent logged

GDPR Article 13 (Information to Data Subjects)
  └─ Cookiebot: ✅ Cookie declaration shows what data is collected

GDPR Article 17 (Right to Erasure)
  └─ Cookiebot: ✅ User can withdraw consent and delete cookies

GDPR Article 21 (Right to Object)
  └─ Cookiebot: ✅ User can object via cookie settings


┌─────────────────────────────────────────────────────────────────────────────┐
│                         SPAIN-SPECIFIC COMPLIANCE                            │
└─────────────────────────────────────────────────────────────────────────────┘

AEPD (Agencia Española de Protección de Datos) Requirements:
  ✅ Opt-in consent (not opt-out)
  ✅ Clear information about cookies
  ✅ Easy way to withdraw consent
  ✅ Consent documented and stored
  ✅ IP anonymization for analytics
  ✅ Spanish language support

LSSI (Ley de Servicios de la Sociedad de la Información) Requirements:
  ✅ Cookie policy page (TODO: Create)
  ✅ Privacy policy page (TODO: Create)
  ✅ Clear cookie information
  ✅ Consent before non-essential cookies


┌─────────────────────────────────────────────────────────────────────────────┐
│                              KEY URLS                                        │
└─────────────────────────────────────────────────────────────────────────────┘

Cookiebot Dashboard: https://manage.cookiebot.com
Pull Request: https://github.com/u7934364978-maker/focusonenglish/pull/7
AEPD: https://www.aepd.es
Implementation Guide: ./COOKIEBOT_IMPLEMENTATION.md
Summary: ./COOKIEBOT_SUMMARY.md

